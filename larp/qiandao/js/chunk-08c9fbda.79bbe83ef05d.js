(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08c9fbda"],{3731:function(e,t,a){},"45bf":function(e,t,a){},"65dd":function(e,t,a){"use strict";a("45bf")},"69b7":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"wrp"},[e._m(0),t("div",{staticClass:"content"},[e._m(1),t(a.SpecList,{attrs:{specData:a.specData,currentSelectedSpecs:a.currentSelectedSpecs},on:{onClickSpecItem:a.onClickSpecItem}}),t(a.CardList,{attrs:{mapData:a.spuMapList,imgsResultUrlList:a.aggregateImages,specData:a.specData,currentSelectedSpecs:a.currentSelectedSpecs},on:{onClickResultListItem:a.onClickResultListItem,onRemoveOneCard:a.onRemoveOneCard}}),a.remainingJobCount>0?t("div",{staticClass:"remaining-job"},[e._v(" 正在智能识别, 剩余任务("+e._s(a.remainingJobCount)+") ")]):e._e()],1),t("div",{staticClass:"actions"},[t(a.DuButton,{attrs:{full:"",size:"large"},on:{click:a.handlePublish}},[e._v("确认发布")])],1)])},c=[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"header"},[t("img",{attrs:{src:"https://cdn.qiandaoapp.com/interior/images/997f97ac6b6c3a565161a3d585f725be.png",alt:""}})])},function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"content-section"},[t("div",{staticClass:"content-section-title"},[e._v(" 批量设置 "),t("div",{staticClass:"content-section-title-tips"},[e._v(" 确定调整后会应用到所有商品 ")])])])}],i=(a("14d9"),a("2b0e")),n=a("39d4"),l=(a("809c"),a("886e")),r=a("dcf0"),u=a("a382"),o=a("7cb2"),d=a("ed08"),p=a("dd8a"),v=a("ccbb"),m=a("ccf4"),g=a("69a5"),f={__name:"index",setup(e){const{proxy:t}=Object(i["getCurrentInstance"])(),a=[{name:"来源",key:"from",list:[{label:"现货",value:"1"},{label:"抽卡机直发",value:"61460"}]},{name:"状态",key:"status",list:[{label:"通行品相",value:"9"},{label:"有瑕疵",value:"10"},{label:"评级卡",value:"11"},{label:"有损伤",value:"155397"}]}],s={currentPrice:void 0,currentCount:1,isShowRemark:!1,remark:""},c=Object(i["ref"])(["1","9"]),f=Object(i["ref"])(),b=Object(i["ref"])([]),h=Object(i["ref"])([]),_=Object(i["ref"])(["https://cdn.qiandaoapp.com/interior/images/215a953d55e59edfb9de9f4c0202bfe8.png","https://cdn.qiandaoapp.com/interior/images/215a953d55e59edfb9de9f4c0202bfe8.png"]),I=Object(i["ref"])([]),C=Object(i["ref"])(0),S=Object(i["computed"])(()=>b.value.length-C.value),y=({itemData:e,singleData:t})=>{const a=c.value;let s=-1,i="";e.list.forEach(e=>{a.includes(e.value)&&(i=e.value)}),i!==t.value&&(s=a.indexOf(i)),-1!==s?(a.splice(s,1),a.push(t.value)):a.push(t.value)},O=e=>{const t=I.value;let a=0;I.value.forEach((t,s)=>{t.index===e&&(a=s)}),t.splice(a,1),I.value=t},k=({singleData:e,itemIndex:t})=>{const a=I.value;let s=0;I.value.forEach((e,a)=>{e.index===t&&(s=a)}),a[s].currentActivedItem=e,I.value=a},w=async()=>{const e=await p["a"].fetchStep2BizConfig(),t=null===e||void 0===e?void 0:e.pluginsBizConfig[f.value];for(let a=0;a<_.value.length;a++)p["a"].searchSpuByAggregateImages({needCut:!0,scene:t.scene,url:_.value[a],typeIds:["1405184","1000375","1002041","1132249","49695"]}).then(e=>{var t;const a=(null===(t=e.data)||void 0===t?void 0:t.results)||[];"0"===e.code&&a.length&&a.forEach((e,t)=>{const a=e.list||[];h.value.push(e.originImageUrl);const c=Object.assign(a[0],s),i=a.map(e=>Object.assign(e,s)),n=h.value.length-1;I.value.push({index:n,hitLogId:e.hitLogId,currentActivedItem:c,splitImgUrl:e.originImageUrl,list:i.slice(0,20)})})}).finally(()=>{if(console.log("aggregateImages===",h.value),C.value++,C.value>=_.value.length){const e=I.value.map(e=>({hitLogId:e.hitLogId,hitResult:e.currentActivedItem.id,hitResultType:"SPU"}));m["a"].reportAnnotationData({items:e}).then(e=>{console.log("上报res",e)})}else console.log("wait report img")})},j=async()=>{const e=I.value.some(e=>!+e.currentActivedItem.currentPrice);if(!c.value.length)return void u["c"].show({icon:"none",title:"请选择面交时间"});if(e)return void u["c"].show({icon:"none",title:"有未填写价格的商品哦"});u["b"].show({title:"发布中"});const a=I.value.map(e=>({spuId:e.currentActivedItem.id,stock:e.currentActivedItem.currentCount,price:parseFloat((+e.currentActivedItem.currentPrice).toFixed(2)),remark:e.currentActivedItem.remark,status:"ON_SALE",specValueIds:c.value,attachments:[{type:"image",url:e.splitImgUrl}]})),s=await v["a"].createProductMulti({args:a});if(await Object(g["b"])({productIds:s.data.productIds,scene:"multi_plugins"}),0===s.code){const e="/modules/pages-plugin/publisher?biz="+f.value;(Object(d["h"])()||Object(d["d"])())&&t.navigateTo({url:e})}else u["c"].show({icon:"none",title:"发布失败"});u["b"].hide()},L=()=>{t.navigateTo({url:"/modules/pages/web-view/index?url=https://mp.weixin.qq.com/s/rzJv9RYgpupvNOJ7e8cKsA"})},x=()=>{t.navigateTo({url:"/pages-me/users/product-on-sale?source=selling"})},D=()=>{t.navigateTo({url:"/pages-me/users/poster?"})};return Object(i["onMounted"])(async()=>{const{biz:e,filesKey:a}=t.$route.query;f.value=e;const s=await Object(o["c"])({key:a});_.value=s.data,w()}),{__sfc:!0,proxy:t,specData:a,defaultItemInfo:s,currentSelectedSpecs:c,localBiz:f,fileList:b,aggregateImages:h,imgsResultUrlList:_,spuMapList:I,spuMapCount:C,remainingJobCount:S,onClickSpecItem:y,onRemoveOneCard:O,onClickResultListItem:k,handleSearchSpuList:w,handlePublish:j,handleFollow:L,goToSelling:x,handlePoster:D,DuButton:n["a"],CardList:l["a"],SpecList:r["a"]}}},b=f,h=(a("65dd"),a("0c7c")),_=Object(h["a"])(b,s,c,!1,null,"4e886587",null);t["default"]=_.exports},"9bb9":function(e,t,a){"use strict";a("3731")},dcf0:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"speclist"},e._l(e.specData,(function(s,c){return t("div",{key:c,staticClass:"speclist-item"},[t("div",{staticClass:"name"},[e._v(" "+e._s(s.name)+" "),t("span",{staticClass:"name-hint"},[e._v("*")])]),t("div",{staticClass:"opts"},e._l(s.list,(function(c,i){return t("div",{key:i,class:"opts-item "+(e.currentSelectedSpecs.includes(c.value)&&"opts-item--actived"),on:{click:function(e){return a.handleClicItem(s,c)}}},[e._v(" "+e._s(c.label)+" ")])})),0)])})),0)},c=[],i=(a("d17e"),{__name:"SpecList",props:{specData:{type:Array,default:()=>[]},currentSelectedSpecs:{type:Array,default:()=>[]}},emits:["onClickSpecItem"],setup(e,{emit:t}){const a=(e,a)=>{t("onClickSpecItem",{itemData:e,singleData:a})};return{__sfc:!0,emits:t,handleClicItem:a}}}),n=i,l=(a("9bb9"),a("0c7c")),r=Object(l["a"])(n,s,c,!1,null,"54a85872",null);t["a"]=r.exports}}]);