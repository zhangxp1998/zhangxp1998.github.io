(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fcc8619"],{"2be1":function(t,r,e){"use strict";e.r(r);var o=function(){var t=this,r=t._self._c;return r("div",{staticClass:"order-detail"},[t.orderDetail?r("div",{staticClass:"products"},[r("div",{staticClass:"products__name otext"},[t._v(t._s(t.orderDetail.groupon.title))]),r("div",{staticClass:"products__list"},t._l(t.orderDetail.orderProducts,(function(t){return r("Product",{key:t.productId,attrs:{product:t}})})),1)]):t._e(),t.orderDetail?r("BottomBar",{attrs:{orderDetail:t.orderDetail},on:{reload:t.loadOrder}}):t._e()],1)},d=[],s=(e("e17f"),e("2241")),i=(e("13d5"),function(){var t=this,r=t._self._c;return r("div",{staticClass:"order-bottom"},[t.orderDetail.status===t.ORDER_STATUS.WAIT_BUYER_PAY&&t.me.id===t.orderDetail.buyerId?[r("div",{staticClass:"order-bottom__btn",on:{click:t.cancelOrder}},[t._v("取消订单")]),r("div",{staticClass:"order-bottom__btn order-bottom__btn--light",on:{click:t.pay}},[t._v(" 马上支付 ")])]:t.orderDetail.status===t.ORDER_STATUS.CANCELED?[r("div",{staticClass:"order-bottom__btn order-bottom__btn--grey"},[t._v("订单已取消")])]:[r("div",{staticClass:"order-bottom__btn order-bottom__btn--grey"},[t._v("已支付")])]],2)}),c=[],a=e("2f62"),n=e("9b2a");const _={C2C:"C2C",LOTTERY:"LOTTERY",DELIVER_FROM_WAREHOUSE:"DELIVER_FROM_WAREHOUSE",AUCTION:"AUCTION",GROUPON:"GROUPON",GROUPON_V3_HOSTABLE:"GROUPON_V3_HOSTABLE",GROUPON_V3_EXPRESS:"GROUPON_V3_EXPRESS",MALL:"MALL",BLIND_BOX_MACHINE:"BLIND_BOX_MACHINE",EXCHANGE:"EXCHANGE",LOTTERY_DEPOSIT:"LOTTERY_DEPOSIT",GLOBAL_DEPOSIT:"GLOBAL_DEPOSIT",LUCKY_BAG:"LUCKY_BAG"},u={WAIT_SELLER_CONFIRM_ORDER:"WAIT_SELLER_CONFIRM_ORDER",WAIT_BUYER_PAY:"WAIT_BUYER_PAY",WAIT_SELLER_SEND_GOODS:"WAIT_SELLER_SEND_GOODS",WAIT_BUYER_CONFIRM_GOODS:"WAIT_BUYER_CONFIRM_GOODS",BUYER_CONFIRM_GOODS:"BUYER_CONFIRM_GOODS",CANCELED:"CANCELED",WAIT_REFUND:"WAIT_REFUND",REFUNDING:"REFUNDING",WAIT_RETURN_REFUND_APPROVE:"WAIT_RETURN_REFUND_APPROVE",LOCKED:"LOCKED"};_.C2C,_.LOTTERY,_.DELIVER_FROM_WAREHOUSE,_.AUCTION,_.GROUPON,_.GROUPON_V3_HOSTABLE,_.GROUPON_V3_EXPRESS,_.C2C,_.LOTTERY,_.DELIVER_FROM_WAREHOUSE,_.AUCTION,_.GROUPON,_.GROUPON_V3_HOSTABLE,_.GROUPON_V3_EXPRESS,_.MALL,_.BLIND_BOX_MACHINE,_.EXCHANGE,_.LOTTERY_DEPOSIT,_.GLOBAL_DEPOSIT,_.LUCKY_BAG;var O=e("3cc9"),E=e("ed08"),p=e("7eb3");function l({isV2:t,orderId:r,info:e,tradeType:o="order",price:d,depositMoney:s,depositType:i,description:c,paySuccessId:a}){if(Object(E["h"])()){const n=O["a"].tokenSync(p["b"]);let _="";_=t?`/modules/pages-payment/pay/index?description=${c||""}&orderId=${r}&tradeType=${o}&info=${e}&price=${d}&depositMoney=${s}&depositType=${i}`:`/pages-common/payment/index?description=${c||""}&orderId=${r}&tradeType=${o}&info=${e}&price=${d}&depositMoney=${s}&depositType=${i}`,a&&(_+="&paySuccessId="+a),n&&(_+="&token="+n),wx.miniProgram.navigateTo({url:_})}}var R={props:{orderDetail:{type:Object,required:!0}},data(){return{ORDER_STATUS:u}},computed:{...Object(a["mapState"])("user",["me"])},methods:{async cancelOrder(){const{orderDetail:t}=this,{id:r}=t;try{await n["a"].buyerCancelOrder(r,{reason:"我不想买了"}),this.$emit("reload")}catch(e){this.$toast.show({title:e.message})}},pay(){const{orderDetail:t}=this,{id:r,shouldPayAmount:e}=t;l({orderId:r,price:e,info:"groupon",tradeType:"groupon",redirectPath:"/payment/success?orderId="+r})}}},C=R,T=(e("ad47"),e("0c7c")),I=Object(T["a"])(C,i,c,!1,null,"24897b7b",null),D=I.exports,A=function(){var t=this,r=t._self._c;return r("div",{staticClass:"order-product"},[r("div",{staticClass:"order-product__left"},[r("div",{staticClass:"order-product__name otext"},[t._v(" "+t._s(t.product.snapshot.product.name)+" ")]),r("div",{staticClass:"order-product__desc otext"},[t._v(" "+t._s(t.product.snapshot.product.description)+" ")])]),r("div",{staticClass:"order-product__right"},[r("div",{staticClass:"order-product__price"},[t._v("￥"+t._s(t.price))]),r("div",{staticClass:"order-product__count"},[t._v("x "+t._s(t.product.count))])])])},b=[],L=e("7f29"),N={props:{product:{type:Object,required:!0}},computed:{price(){const{product:t}=this;return Object(L["a"])(t.price)}}},S=N,U=(e("6b7b"),Object(T["a"])(S,A,b,!1,null,null,null)),f=U.exports,m={components:{BottomBar:D,Product:f},data(){return{orderId:null,orderDetail:null,grouponGoodsCount:null}},mounted(){const{orderId:t,grouponGoodsCount:r}=this.$route.query;r&&(this.grouponGoodsCount=r),t?(this.orderId=t,this.loadOrder()):this.$toast.show({title:"订单不存在"})},methods:{async loadOrder(){const{grouponGoodsCount:t}=this,r=await n["a"].getOrderDetail(this.orderId);this.orderDetail=r;const e=r.orderProducts.reduce((t,r)=>r.count+t,0);t&&t>e&&(Object(s["a"])({message:`你所选的商品有 ${t-e} 个已售罄，其余商品已创建订单，请尽快支付`}),this.grouponGoodsCount=0)}}},P=m,G=(e("3424"),Object(T["a"])(P,o,d,!1,null,"13a2b72b",null));r["default"]=G.exports},3424:function(t,r,e){"use strict";e("fdf8")},"6b7b":function(t,r,e){"use strict";e("bf9b")},"7f29":function(t,r,e){"use strict";function o(t,r=2,e=!1){return t=(+t).toFixed(r),e?t:Number(t)+""}e.d(r,"a",(function(){return o}))},"9b2a":function(t,r,e){"use strict";var o=e("0ef7");r["a"]={getOrderBasicModelList(t){return o["j"].post("/order-web/user/load-order-base-model-list",t)},getOrderDetail(t){return o["p"].get("/orders/"+t)},buyerCancelOrder(t,r){return o["p"].post(`/orders/${t}/action/buyer-cancel-order`,r)}}},ad47:function(t,r,e){"use strict";e("ded8")},bf9b:function(t,r,e){},ded8:function(t,r,e){},fdf8:function(t,r,e){}}]);