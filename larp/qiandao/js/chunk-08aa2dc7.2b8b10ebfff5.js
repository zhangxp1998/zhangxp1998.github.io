(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08aa2dc7"],{"0d93":function(t,e,i){"use strict";i("91a2")},"25ee":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"page-get-coupon",attrs:{"infinite-scroll-disabled":"busy","infinite-scroll-distance":"10"}},["loading"===t.loadingStatus?e("div",{staticClass:"page-get-coupon-status"},[t._v(" 加载中... ")]):"error"===t.loadingStatus?e("div",{staticClass:"page-get-coupon-status"},[t._v(" "+t._s(t.errorMessage)+" ")]):[e("div",{staticClass:"get-coupon-outer"},[t.couponInfo?e("base-coupon",{attrs:{coupon:t.couponInfo}}):e("div",{staticClass:"coupon"},[e("div",{staticClass:"coupon-left"},[e("div",{staticClass:"coupon-yen"},[t._v("¥")]),e("div",{staticClass:"coupon-price"},[t._v(t._s(t.couponInfo.price))])]),e("div",{staticClass:"coupon-right"},[e("div",{staticClass:"coupon-title otext"},[t._v(t._s(t.couponInfo.name))]),e("div",{staticClass:"coupon-desc"},[t._v(t._s(t.couponInfo.description))])])]),e("LoginButton",{attrs:{redirectPath:"/promotion/get-coupon?couponId="+t.couponId},on:{success:t.handleGetCouponClick}},[e("div",{class:["get-btn",t.issued?"get-btn--disabled":""]},[t._v(" "+t._s(t.buttonText)+" ")])]),t._m(0)],1),t.hideList?t._e():e("div",{staticClass:"available-items-outer"},[e("div",{staticClass:"available-items-title"},[t._v("优惠券可用商品")]),t.isExchangeType?t._e():e("div",{staticClass:"shelf-sort"},[e("Sort",{attrs:{paddingLeft:"0rpx",sorts:t.filterSorts,current:t.currentSort},on:{change:t.handleCurrentSortChange}})],1),t.isExchangeType?e("div",{staticClass:"available-items"},t._l(t.spus,(function(i){return e("sale-item",{key:i.id,attrs:{item:i},on:{tap:function(e){return t.handleItemClick(i)}}})})),1):e("div",{staticClass:"available-items"},t._l(t.rows,(function(i){return e("ShelfItem",{key:i.id+(i.grouponConfigId?"."+i.grouponConfigId:""),attrs:{shelf:i},on:{tap:function(e){return t.onShelfItemClick(i.id)}}})})),1)])],t.shareGuide?e("shareGuide",{on:{close:t.handleCloseGuide}}):t._e()],2)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"coupon-descriptions"},[e("div",[t._v("1.同一订单中仅可使用一张优惠券，不叠加使用。")]),e("div",[t._v("2.优惠券可与购物金叠加使用。")]),e("div",[t._v(" 3.领取成功后，可进入小程序-我的-红包/优惠券，查看已有优惠券。 ")]),e("div",[t._v("4. 如用于闪购交易，购买后商品不能出售。")])])}],n=(i("e17f"),i("2241")),a=i("2f62"),r=function(){var t=this,e=t._self._c;return e("div",{class:["base-coupon-container",t.disabled?"disabled":""]},[e("div",{class:["visibility",t.disabled?"disabled":""]},[t._v(" "+t._s(t.coupon.visibilityText)+" ")]),e("div",{staticClass:"left u-flex-col-c-c"},[e("div",{class:["price-wrap",t.disabled?"disabled":""]},[1===t.coupon.discountType||"FIXED_AMOUNT"===t.coupon.discountType?e("span",{staticClass:"icon"},[t._v(" ￥ ")]):t._e(),e("span",{staticClass:"price"},[t._v(t._s(t.formatetdPrice))]),2===t.coupon.discountType||"FIXED_PERCENTAGE"===t.coupon.discountType?e("span",{staticClass:"icon"},[t._v(" 折 ")]):t._e()]),e("div",{class:["condition",t.disabled?"disabled":""]},[t._v(" "+t._s(t.couponLimitText)+" ")])]),e("div",{staticClass:"right"},[e("div",{staticClass:"top u-flex-c-sb"},[e("div",{staticClass:"content u-flex-col-s-c"},[e("div",{class:["otext","title",t.disabled?"disabled":""]},[t._v(" "+t._s(t.title)+" ")]),e("div",{class:["otext","date",t.isAboutToExpire?"date--warning":"",t.disabled?"disabled":""]},[t._v(" "+t._s(t.dateRangeText)+" ")])]),t._t("btn")],2),e("div",{class:["bottom","u-flex-c-sb"]},[e("div",{class:["desc","otext2",t.disabled?"disabled":""]},[t._v(" "+t._s(t.description)+" ")])])]),t.isAboutToExpire&&!t.disabled?e("img",{staticClass:"expired",attrs:{src:"https://cdn.qiandaoapp.com/admins/6640173d927dd516aa3d8503ad68b875.png"}}):t._e()])},l=[],c=i("9b02"),u=i.n(c),d=i("72f9"),p=i.n(d),h=i("5a0c"),v=i.n(h),f=i("ed08"),m=i("2e3f");function g(t="toDay",e){const i=parseInt(e);return"toDay"===t?parseInt(i/86400):"toSeconds"===t?parseInt(24*i*60*60):null}async function C(t,e){var i,s,o,a;if(!t)return!1;const r=e?null===t||void 0===t||null===(i=t.issueCondition)||void 0===i||null===(s=i.packageId)||void 0===s?void 0:s.data:null===t||void 0===t||null===(o=t.useCondition)||void 0===o||null===(a=o.packageId)||void 0===a?void 0:a.data;if(!r)return;const l=new URLSearchParams(document.location.search),c=null===l||void 0===l?void 0:l.pkg,u=e?"领取":"使用";if(!r.includes(c)){let t,e,i;if(r.includes("1020"))t=f["j"].drama,e=`请前往千岛剧本杀小程序${u}，点击跳转「千岛剧本杀」小程序`,i="pages-tab/drama/groupon-list/index";else{if(!r.includes("1021"))return await n["a"].confirm({message:"此券仅可在千岛APP中使用,点击「立即领取」下载千岛APP",confirmButtonText:"立即"+u}),Object(m["a"])("/modules/pages/web-view/index?url="+encodeURIComponent("https://config-cdn.echoing.tech/docs/appdownload.html")),!0;t=f["j"].drama_helper,e=`请前往米花星球小程序${u}，点击跳转「米花星球」小程序`,i="pages-tab/home/index"}return await n["a"].confirm({message:e,confirmButtonText:"立即"+u}),Object(m["a"])(`/modules/pages/common/redirect?url=${encodeURIComponent("/"+i)}&appid=${t}`),!0}return!1}var b={props:{disabled:{type:Boolean,default:!1},coupon:{type:Object,default(){return{}}}},data(){return{countInterval:null,intervalRange:""}},computed:{formattedStart(){const t=v()(),e=this.coupon;if(e.startedAt){const i=v()(e.startedAt);return t.year()===i.year()?i.format("MM-DD HH:mm"):i.format("YYYY-MM-DD HH:mm")}return null},formattedEnd(){const t=v()(),e=this.coupon;if(e.endedAt){const i=v()(e.endedAt);return t.year()===i.year()?i.format("MM-DD HH:mm"):i.format("YYYY-MM-DD HH:mm")}return null},isAboutToExpire(){if(this.disabled)return!1;const t=this.coupon.endedAt;if(t){const e=v()(t),i=e.valueOf()-v()().valueOf();return i>0&&i<864e5}return!1},dateRangeText(){var t;return this.isAboutToExpire&&!this.disabled?this.intervalRange:this.formattedStart&&this.formattedEnd?`有效期 ${this.formattedStart} 至 ${this.formattedEnd}`:this.formattedStart?v()(this.coupon.startedAt).isAfter(v()())?this.formattedStart+"起有效":"有效期：长期有效":this.formattedEnd?this.formattedEnd+"失效":"AFTERISSUE"===(null===(t=this.coupon)||void 0===t?void 0:t.expiredType)?`有效期：领取后${g("toDay",this.coupon.expireSeconds)}天内有效`:"有效期：长期有效"},title(){var t,e;return(null===(t=this.coupon)||void 0===t||null===(e=t.meta)||void 0===e?void 0:e.name)||"未命名红包"},couponLimitText(){var t,e;if(null!==(t=this.coupon)&&void 0!==t&&null!==(e=t.useCondition)&&void 0!==e&&e.minUsePrice){if(u()(this.coupon.useCondition,"minUsePrice.totalPriceMin.value"))return"满"+u()(this.coupon.useCondition,"minUsePrice.totalPriceMin.value")+"可用";if(u()(this.coupon.useCondition,"minUsePrice.productPriceMin.value"))return"满"+u()(this.coupon.useCondition,"minUsePrice.productPriceMin.value")+"可用";if(u()(this.coupon.useCondition,"minUsePrice.expressPriceMin.value"))return"满"+u()(this.coupon.useCondition,"minUsePrice.expressPriceMin.value")+"可用"}return"无门槛"},description(){var t,e;return(null===(t=this.coupon)||void 0===t?void 0:t.description)||(null===(e=this.coupon)||void 0===e?void 0:e.limitDescription)},formatetdPrice(){const{discountType:t,price:e}=this.coupon;return"FIXED_PERCENTAGE"===t||2===t?p()(e).value:Number(e)},visibilityText(){const t=this.coupon.type;return"SHOP"===t?"商家券":"平台券"}},created(){this.isAboutToExpire&&!this.disabled&&(this.intervalRange=this.couponCountDown(),this.countInterval=setInterval(()=>{this.intervalRange=this.couponCountDown()},1e3))},methods:{couponCountDown(){if(this.isAboutToExpire&&!this.disabled){let t=v()(this.coupon.endedAt).valueOf()-v()().valueOf();t=parseInt(t/1e3);const e=Math.floor(t/3600%24),i=Math.floor(t/60%60),s=t%60;if(e<=0&&i<=0&&s<=0)return clearInterval(this.countInterval),this.formattedStart&&this.formattedEnd?`有效期 ${this.formattedStart} 至 ${this.formattedEnd}`:"有效期：已失效";const o=(""+e).padStart(2,"0"),n=(""+i).padStart(2,"0"),a=(""+s).padStart(2,"0");return`有效期 仅剩 ${o}:${n}:${a}`}return clearInterval(this.countInterval),""}}},_=b,y=(i("9917"),i("0c7c")),I=Object(y["a"])(_,r,l,!1,null,null,null),x=I.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"shelf-item",on:{click:t.handleClick}},[e("div",{staticClass:"cover",style:{backgroundImage:`url(${t.shelf.images.coverImage}!fill_w540_h432_jpg)`}},[t.shelf.grouponConfig?e("div",{staticClass:"right-tag"},[t._v(" "+t._s(t.shelf.grouponConfig.success_min_users_count)+"人团使用 ")]):t._e(),t.shelf.isOnShelf?t._e():e("div",{staticClass:"put-off"},[t._v("已下架")])]),e("div",{staticClass:"main"},[e("div",{staticClass:"name otext"},[t._v(t._s(t.shelf.name))]),e("div",{staticClass:"label-outer"},t._l(t.labels,(function(i){return e("div",{key:i.text,staticClass:"label",style:{color:i.color,borderColor:i.color}},[t._v(" "+t._s(i.text)+" ")])})),0),e("div",[e("div",{staticClass:"price-outer"},[e("div",{staticClass:"yen"},[t._v("¥")]),e("div",{staticClass:"price"},[t._v(t._s(t.unitPriceOfCash))])])]),e("div",{staticClass:"org-info"},[e("div",{staticClass:"avatar"},[e("img",{staticClass:"avatar-inner",attrs:{src:t.shelf.org.avatar}})]),e("div",{staticClass:"nickname"},[t._v(t._s(t.shelf.org.nickName))])])])])},S=[],T=(i("14d9"),{props:{shelf:{type:Object,required:!0}},computed:{...Object(a["mapState"])("app",["puppet"]),unitPriceOfCash(){return p()(this.shelf.unitPriceOfCash,{symbol:""}).value},labels(){const t=22;let e=0;const i=[];return(this.shelf.label||[]).forEach(s=>{const o=s.text;for(let t=0;t<o.length;t++)o.charCodeAt(t)<=128?e+=1:e+=2;e<=t&&i.push(s)}),i}},methods:{handleNavigate(t){var e;const i=["1004","1015","1027","1035","1030"];i.includes(String(null===(e=this.puppet)||void 0===e?void 0:e.id))?this.navigateTo({url:t}):this.navigateTo({url:`/modules/pages/common/redirect?url=${encodeURIComponent(t)}&appid=wx847b9c629ff98fa2`})},handleClick(){if(this.$emit("tap"),this.shelf.isOnShelf)if(Object(f["e"])())this.$toast.show({title:`微信搜索小程序「${this.puppet.nameCN}」去使用红包`});else if("BLIND_BOX_MACHINE"===this.shelf.type){const t="/packages/box/index?id="+this.shelf.id;this.handleNavigate(t)}else if("B2C"===this.shelf.type){const t="/modules/pages-btoc/mall/detail?id="+this.shelf.id;this.handleNavigate(t)}else if("KUJI"===this.shelf.type){const t="/modules/pages-kuji/detail?id="+this.shelf.id;this.handleNavigate(t)}else if("GACHA"===this.shelf.type){const t="/modules/pages-gacha/detail?id="+this.shelf.id;this.handleNavigate(t)}}}}),O=T,P=(i("dbc5"),Object(y["a"])(O,w,S,!1,null,"21d1e0c5",null)),$=P.exports,M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-wrap",on:{click:t.handleExchangeItemClick}},[e("img",{staticClass:"cover",attrs:{loading:"lazy",src:t.item.cover,alt:""}}),e("div",{staticClass:"content"},[e("div",{staticClass:"left"},[t.item.tagName?e("div",{staticClass:"category-name otext"},[t._v(t._s(t.item.tagName))]):t._e(),e("div",{staticClass:"name otext"},[t._v(t._s(t.item.name))])]),e("div",{staticClass:"right"},[e("div",{staticClass:"price-wrap"},[e("span",{staticClass:"yuan"},[t._v("￥")]),t.item.minPrice?e("span",{staticClass:"price"},[t._v(" "+t._s(t.item.minPrice)+" ")]):e("span",{staticClass:"price"},[t._v(t._s(t.item.price))])])])])])},E=[],A={props:{item:{type:Object,default(){return{}}}},methods:{handleExchangeItemClick(){this.$emit("tap")}}},k=A,L=(i("c738"),Object(y["a"])(k,M,E,!1,null,"29d3a12b",null)),D=L.exports,j=i("5df5"),N=i("8a44"),R=i("a0f0"),G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-sort"},t._l(t.sorts,(function(i,s){return e("div",{key:i.type,class:["m-sort-item",{"m-sort-item--active":t.current.type===i.type}],style:{paddingLeft:0===s?t.paddingLeft:"20rpx",color:t.current.type===i.type?t.activeColor:"#202426"},on:{click:function(e){return t.changeSort(i)}}},[e("div",{style:{marginRight:i.hasOrder?"8rpx":"0"}},[t._v(" "+t._s(i.name)+" ")]),i.hasOrder?e("SortArrow",{attrs:{order:t.current.order}}):t._e()],1)})),0)},B=[],U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-sort-arrow"},[e("div",{staticClass:"m-left"},[e("div",{staticClass:"sort-arrow",style:{borderColor:`transparent transparent ${t.leftColor} transparent`}}),e("div",{staticClass:"sort-bar",style:{borderRightColor:t.leftColor}})]),e("div",{staticClass:"m-right"},[e("div",{staticClass:"sort-arrow",style:{borderColor:`transparent transparent ${t.rightColor} transparent`}}),e("div",{staticClass:"sort-bar",style:{borderRightColor:t.rightColor}})])])},q=[],H={name:"SortArrow",props:{order:{type:String,default:"none"}},data(){return{color:"rgba(32, 36, 38, 0.2)",activeColor:"#FF3355"}},computed:{leftColor(){switch(this.order){case"asc":return this.activeColor;case"desc":return this.color;default:return this.color}},rightColor(){switch(this.order){case"asc":return this.color;case"desc":return this.activeColor;default:return this.color}}}},F=H,V=(i("0d93"),Object(y["a"])(F,U,q,!1,null,null,null)),Y=V.exports,J={name:"Sort",components:{SortArrow:Y},props:{sorts:{type:Array},current:{type:Object},paddingLeft:{type:String,default:"20rpx"}},data(){return{activeColor:"#FF3355"}},methods:{changeSort(t){const{current:e}=this;if(t.type!==e.type)this.$emit("update:current",{...t,order:t.hasOrder?"asc":"default"}),this.$emit("change",{...t,order:t.hasOrder?"asc":"default"});else if(t.type===e.type&&t.hasOrder){const i="asc"===e.order?"desc":"asc";this.$emit("update:current",{...t,order:i}),this.$emit("change",{...t,order:i})}}}},X=J,W=(i("52dc"),Object(y["a"])(X,G,B,!1,null,null,null)),z=W.exports,K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-share-guide"},[e("div",{staticClass:"guide-mask",on:{click:t.handleCloseGuide}}),t._m(0)])},Q=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"guide-container"},[e("div",{staticClass:"item"},[e("div",{staticClass:"item__text"},[t._v("1.点击右上角唤起转发界面")]),e("img",{staticClass:"item__menu",attrs:{alt:"",src:"https://cdn.qiandaoapp.com/interior/images/295526eebf1cf200c3fa48bd05514707.png"}})]),e("div",{staticClass:"item"},[e("div",{staticClass:"item__text"},[t._v("2.选择转发给朋友即可领取")]),e("img",{staticClass:"item__forward",attrs:{alt:"",src:"https://cdn.qiandaoapp.com/interior/images/e387612005e52179cf549d37b0dcc17b.png"}})])])}],Z={name:"ShareDuide",emits:["close"],setup(t,{emit:e}){const i=()=>{e("close")};return{handleCloseGuide:i}}},tt=Z,et=(i("b0ae"),Object(y["a"])(tt,K,Q,!1,null,null,null)),it=et.exports;const st={name:"默认",type:"sortOrder",order:"default"},ot=t=>t.type+"."+(t.order||"default");var nt={components:{SaleItem:D,ShelfItem:$,BaseCoupon:x,LoginButton:N["a"],Sort:z,shareGuide:it},data(){return{couponId:"",loadingStatus:"loading",rows:[],spus:[],couponInfo:null,limit:10,offset:0,hasMore:!0,isLoadingMore:!1,issued:!1,errorMessage:"",successCount:0,currentSort:st,filterSorts:[{name:"默认",type:"sortOrder"},{name:"销量",type:"soldAmount"},{name:"新品",type:"createdAt"},{name:"价格",type:"price",hasOrder:!0}],iv:null,encryptedData:null,shareGuide:!1}},computed:{...Object(a["mapState"])("app",["puppet"]),hideItems(){var t,e,i;if(null!==(t=this.couponInfo)&&void 0!==t&&null!==(e=t.useCondition)&&void 0!==e&&null!==(i=e.typeId)&&void 0!==i&&i.data){const t=this.couponInfo.useCondition.typeId.data;return t.some(t=>"1164122"===t)}return!1},hideList(){var t,e,i,s;return"APPOINTMENT"===(null===(t=this.couponInfo)||void 0===t||null===(e=t.useCondition)||void 0===e?void 0:e.scenes)||"HOST_DELIVER"===(null===(i=this.couponInfo)||void 0===i||null===(s=i.useCondition)||void 0===s?void 0:s.scenes)},busy(){return"loading"===this.loadingStatus||(!!this.isLoadingMore||!this.hasMore)},isExchangeType(){var t,e;return"EXCHANGE"===(null===(t=this.couponInfo)||void 0===t||null===(e=t.useCondition)||void 0===e?void 0:e.scenes)},buttonText(){return this.issued,"立即领取"}},async mounted(){try{var t,e,i,s,o,n,a,r,l,c,u;this.loadingStatus="loading",this.couponId=(null===(t=this.$route.query)||void 0===t?void 0:t.couponId)||null,this.iv=null!==(e=this.$route.query)&&void 0!==e&&e.iv?decodeURIComponent(this.$route.query.iv):null,this.encryptedData=null!==(i=this.$route.query)&&void 0!==i&&i.encryptedData?decodeURIComponent(this.$route.query.encryptedData):null,this.shareGuide="true"===(null===(s=this.$route.query)||void 0===s?void 0:s.shareGuide),await this.getCouponInfo();let f="";const m=(null===(o=this.couponInfo)||void 0===o||null===(n=o.useCondition)||void 0===n||null===(a=n.minUsePrice)||void 0===a||null===(r=a.totalPriceMin)||void 0===r?void 0:r.value)||"",g=(null===(l=this.couponInfo)||void 0===l||null===(c=l.merchant)||void 0===c?void 0:c.nickname)||"";if("FIXED_PERCENTAGE"===(null===(u=this.couponInfo)||void 0===u?void 0:u.discountType)){var d,p,h;const t=(null===(d=this.couponInfo)||void 0===d||null===(p=d.discountValue)||void 0===p?void 0:p.value)||null;f="SHOP"===(null===(h=this.couponInfo)||void 0===h?void 0:h.type)?`${g}送你一张折扣券，满${m}可用`:`快来领取「${this.puppet.nameCN}」${t}折优惠券`}else{var v;f="SHOP"===(null===(v=this.couponInfo)||void 0===v?void 0:v.type)?`${g}送你一张满减券，满${m}可用`:`快来领取「${this.puppet.nameCN}」${this.couponInfo.price}元优惠券`}const C=()=>{var t,e;window.wx&&window.wx.miniProgram&&(null!==(t=this.couponInfo)&&void 0!==t&&null!==(e=t.extra)&&void 0!==e&&e.allowSharePublic||wx.hideMenuItems({menuList:["menuItem:share:appMessage","menuItem:share:timeline"]}),wx.miniProgram.postMessage({data:{shareOptions:{title:f}}}))};window.WeixinJSBridge&&window.WeixinJSBridge.invoke?C():document.addEventListener("WeixinJSBridgeReady",C,!1),this.loadingStatus="success"}catch(f){this.loadingStatus="error",this.errorMessage=f.message||"加载出错了，请稍后再试"}R["a"].track("coupon_common_views")},methods:{onShelfItemClick(t){R["a"].track("coupon_common_shelf",{shelf_id:t})},handleItemClick(t){R["a"].track("coupon_exchange_product",{spu_id:t.spuId});const e="/pages-market/spu/index?defaultTab=exchange&spuId="+t.spuId;this.navigateTo({url:e})},async getCouponInfo(){let{data:t}=await j["a"].getPageGetCouponInfoByTemplateId(this.couponId);var e,i,s,o,n,a,r,l;t&&(t={...t,id:t.id,price:(null===(e=t)||void 0===e||null===(i=e.discountValue)||void 0===i?void 0:i.value)||null,discountType:t.discountType,description:t.description,expireSeconds:(null===(s=t)||void 0===s||null===(o=s.durationSeconds)||void 0===o?void 0:o.value)||null,startedAt:null!==(n=t)&&void 0!==n&&null!==(a=n.startedAt)&&void 0!==a&&a.value?Number(t.startedAt.value):null,endedAt:null!==(r=t)&&void 0!==r&&null!==(l=r.endedAt)&&void 0!==l&&l.value?Number(t.endedAt.value):null,visibilityText:"SHOP"===t.type?"商家券":"平台券",meta:{name:t.title},createdAt:t.createdAt});this.couponInfo=t,this.isExchangeType?await this.fetchSpus():await this.getCouponList()},async fetchSpus(){var t;const{spus:e}=await j["a"].getCouponSpuItemList({templateIds:[null===(t=this.couponInfo)||void 0===t?void 0:t.id],sort:2,limit:this.limit,offset:this.offset});this.spus=this.spus.concat(e),(0===(null===e||void 0===e?void 0:e.length)||(null===e||void 0===e?void 0:e.length)<this.limit)&&(this.hasMore=!1),this.offset+=this.limit},async fetchShelves(){const{data:t}=await j["a"].getCouponRelatedProducts({couponTemplateId:this.couponId,limit:this.limit,offset:this.offset}),{rows:e}=t;this.rows=this.rows.concat(e),0===e.length&&(this.hasMore=!1),this.offset+=this.limit},async getCouponList(){const{rows:t}=await j["a"].getShelfList({couponTemplateId:this.couponId,orderBy:ot(this.currentSort),limit:this.limit,offset:this.offset});this.rows=this.rows.concat(t),0===t.length&&(this.hasMore=!1),this.offset+=this.limit},async handleGetCouponClick(){var t,e;if(R["a"].track("coupon_receive_now"),!this.issued&&!await C(this.couponInfo,!0)){if(null!==(t=this.couponInfo.issueCondition)&&void 0!==t&&null!==(e=t.firstTimeFollowShop)&&void 0!==e&&e.value){var i;if(null!==(i=this.couponInfo)&&void 0!==i&&i.creatorId){const t=`/modules/pages/shop/index?orgId=${this.couponInfo.creatorId}&shouldFirstFollowId=${this.couponId}`;return this.navigateTo({url:t})}return this.$toast.show({title:"商家有误，无法跳转领取！"})}try{var s,o;this.$loading.show({title:"加载中"});let t={};null!==(s=this.couponInfo)&&void 0!==s&&null!==(o=s.extra)&&void 0!==o&&o.onlyShopShareIssued&&(t={iv:this.iv,encryptedData:this.encryptedData}),await j["a"].getPageGetCouponByTemplateId({couponTemplateId:this.couponId,privateMsg:t}),this.$loading.hide(),setTimeout(()=>{this.$toast.show({title:"领取成功，优惠券已放入「我的-优惠券」"})},200),this.successCount+=1,R["a"].track("coupon_receive_count",{count_success:this.successCount})}catch(a){const{code:t,message:e}=a;if(this.$loading.hide(),this.issued=!0,t&&2300036===Number(t)){const t=this,i=()=>{var e;const i=(null===(e=t.couponInfo.issueCondition)||void 0===e?void 0:e.followWechat)||null,s="/modules/pages/web-view/index?url="+encodeURIComponent(i.url);return t.navigateTo({url:s})};return n["a"].confirm({title:"温馨提示",message:e,closeOnPopstate:!0,showCancelButton:!1,confirmButtonText:"去关注",beforeClose(t,e){"confirm"===t&&i(),e()}})}setTimeout(()=>{this.$toast.show({title:a.message||"领取出错了"})},200)}}},async loadMore(){var t;if(null!==(t=this.couponInfo)&&void 0!==t&&t.id)try{this.isLoadingMore=!0;const t=this.isExchangeType?this.fetchSpus:this.getCouponList;await t(),this.isLoadingMore=!1}catch(e){this.isLoadingMore=!1}},handleCurrentSortChange(t){this.currentSort=t,this.rows=[],this.limit=10,this.offset=0,this.getCouponList()},handleCloseGuide(){this.shareGuide=!1}}},at=nt,rt=(i("ba0a"),Object(y["a"])(at,s,o,!1,null,"79863dae",null));e["default"]=rt.exports},"3a0b":function(t,e,i){},"3fa5":function(t,e,i){},"47c1":function(t,e,i){},"52dc":function(t,e,i){"use strict";i("3fa5")},"5ca9":function(t,e,i){},"5df5":function(t,e,i){"use strict";var s=i("0ef7");e["a"]={getCouponSpuItemList(t){return s["h"].post("/stock-order/query-coupon-related-spus",t).then(t=>t.data)},getCouponRelatedProducts(t){return s["h"].get("/promotion/v3/query/get-coupon-related-products",t)},getPageGetCoupon(t){return s["p"].post("/promotions/action/get-page-get-coupon",{productTagId:t})},getPageGetCouponInfoByTemplateId(t){return s["h"].get("/promotion/v3/query/coupon-template",{couponTemplateId:t})},getPageGetCouponByTemplateId(t){return s["h"].post("/promotion/v3/action/manual-get-coupon",t)},queryUnclaimedCoupons(t){return s["h"].get("/promotion/v3/query/available-coupon-templates",t)},getShelfList(t){return s["h"].get("/shelf/shelves/list-universal",t)}}},"72f9":function(t,e,i){(function(e,i){t.exports=i()})(0,(function(){function t(n,a){if(!(this instanceof t))return new t(n,a);a=Object.assign({},i,a);var r=Math.pow(10,a.precision);this.intValue=n=e(n,a),this.value=n/r,a.increment=a.increment||1/r,a.groups=a.useVedic?o:s,this.s=a,this.p=r}function e(e,i){var s=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=i.decimal,n=i.errorOnInvalid,a=i.fromCents,r=Math.pow(10,i.precision),l=e instanceof t;if(l&&a)return e.intValue;if("number"===typeof e||l)o=l?e.value:e;else if("string"===typeof e)n=new RegExp("[^-\\d"+o+"]","g"),o=new RegExp("\\"+o,"g"),o=(o=e.replace(/\((.*)\)/,"-$1").replace(n,"").replace(o,"."))||0;else{if(n)throw Error("Invalid Input");o=0}return a||(o=(o*r).toFixed(4)),s?Math.round(o):o}var i={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:function(t,e){var i=e.pattern,s=e.negativePattern,o=e.symbol,n=e.separator,a=e.decimal;e=e.groups;var r=(""+t).replace(/^-/,"").split("."),l=r[0];return r=r[1],(0<=t.value?i:s).replace("!",o).replace("#",l.replace(e,"$1"+n)+(r?a+r:""))},fromCents:!1},s=/(\d)(?=(\d{3})+\b)/g,o=/(\d)(?=(\d\d)+\d\b)/g;return t.prototype={add:function(i){var s=this.s,o=this.p;return t((this.intValue+e(i,s))/(s.fromCents?1:o),s)},subtract:function(i){var s=this.s,o=this.p;return t((this.intValue-e(i,s))/(s.fromCents?1:o),s)},multiply:function(e){var i=this.s;return t(this.intValue*e/(i.fromCents?1:Math.pow(10,i.precision)),i)},divide:function(i){var s=this.s;return t(this.intValue/e(i,s,!1),s)},distribute:function(e){var i=this.intValue,s=this.p,o=this.s,n=[],a=Math[0<=i?"floor":"ceil"](i/e),r=Math.abs(i-a*e);for(s=o.fromCents?1:s;0!==e;e--){var l=t(a/s,o);0<r--&&(l=l[0<=i?"add":"subtract"](1/s)),n.push(l)}return n},dollars:function(){return~~this.value},cents:function(){return~~(this.intValue%this.p)},format:function(t){var e=this.s;return"function"===typeof t?t(this,e):e.format(this,Object.assign({},e,t))},toString:function(){var t=this.s,e=t.increment;return(Math.round(this.intValue/this.p/e)*e).toFixed(t.precision)},toJSON:function(){return this.value}},t}))},"8a44":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("div",{style:t.styles,on:{click:t.checkLogin}},[t._t("default")],2)},o=[],n=i("2f62"),a=i("e8ad"),r={computed:{...Object(n["mapState"])("user",["me"]),...Object(n["mapState"])("app",["isProduction"])},props:{redirectPath:{type:String},styles:{type:String},loginModal:{type:Boolean,default:!1}},methods:{...Object(n["mapActions"])("user",["login"]),checkLogin(){const t=this.$route.query,{ignoreAuth:e}=t||{};if(e&&window.location.origin.indexOf("localhost")>-1)return void this.$emit("success");const{me:i,redirectPath:s}=this;i&&i.id?this.$emit("success",i):Object(a["a"])({redirectPath:s})}}},l=r,c=i("0c7c"),u=Object(c["a"])(l,s,o,!1,null,"d46cf5e6",null);e["a"]=u.exports},9108:function(t,e,i){},"91a2":function(t,e,i){},9917:function(t,e,i){"use strict";i("5ca9")},b0ae:function(t,e,i){"use strict";i("b135")},b135:function(t,e,i){},ba0a:function(t,e,i){"use strict";i("47c1")},c738:function(t,e,i){"use strict";i("9108")},dbc5:function(t,e,i){"use strict";i("3a0b")}}]);