(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54fe0336"],{"083a":function(e,t,n){"use strict";var i=n("0d51"),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+i(t)+" of "+i(e))}},"3c65":function(e,t,n){"use strict";var i=n("23e7"),r=n("7b0b"),c=n("07fa"),s=n("3a34"),o=n("083a"),a=n("3511"),l=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},d=l||!u();i({target:"Array",proto:!0,arity:1,forced:d},{unshift:function(e){var t=r(this),n=c(t),i=arguments.length;if(i){a(n+i);var l=n;while(l--){var u=l+i;l in t?t[u]=t[l]:o(t,u)}for(var d=0;d<i;d++)t[d]=arguments[d]}return s(t,n+i)}})},"40a2":function(e,t,n){"use strict";n("6afa")},"6afa":function(e,t,n){},"74d3":function(e,t,n){"use strict";n("bbd0")},"972b":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("div",{staticClass:"wrp"},[e._m(0),t("div",{staticClass:"content"},[e._m(1),t(n.SpecList,{attrs:{specData:n.specData,currentSelectedSpecs:n.currentSelectedSpecs}}),t(n.CardList,{attrs:{mapData:n.spuMapList,txtResultUrlList:n.txtResultUrlList,specData:n.specData,currentSelectedSpecs:n.currentSelectedSpecs},on:{onClickResultListItem:n.onClickResultListItem}}),n.remainingJobCount>0?t("div",{staticClass:"remaining-job"},[e._v(" 正在智能识别, 剩余任务("+e._s(n.remainingJobCount)+") ")]):e._e()],1),t("div",{staticClass:"actions"},[t(n.DuButton,{attrs:{full:"",size:"large"},on:{click:n.handlePublish}},[e._v("确认发布")])],1)])},r=[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"header"},[t("img",{attrs:{src:"https://cdn.qiandaoapp.com/interior/images/997f97ac6b6c3a565161a3d585f725be.png",alt:""}})])},function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"content-section"},[t("div",{staticClass:"content-section-title"},[e._v(" 批量设置 "),t("div",{staticClass:"content-section-title-tips"},[e._v(" 确定调整后会应用到所有商品 ")])])])}],c=(n("3c65"),n("14d9"),n("13d5"),n("2b0e")),s=n("39d4"),o=(n("809c"),n("1510"),n("dcf0")),a=(n("dff2"),n("a382")),l=n("7cb2"),u=n("69a5"),d=n("ccbb"),v=n("dd8a"),m=n("ed08"),p=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("div",{staticClass:"cardlist"},e._l(e.mapData,(function(i,r){var c,s,o,a,l,u,d,v,m,p,g,f,h,C,I,b,_,A,w;return t("div",{key:i.index},[null!==i&&void 0!==i&&null!==(c=i.currentActivedItem)&&void 0!==c&&null!==(s=c.imgs)&&void 0!==s&&s.whiteBgPng||null!==i&&void 0!==i&&null!==(o=i.currentActivedItem)&&void 0!==o&&null!==(a=o.imgs)&&void 0!==a&&a.cover?t("div",{staticClass:"cardlist-item"},[0===r?t("div",{staticClass:"successcount"},[e._v(" 文字识别到以下商品，共"+e._s(n.countInfo.successCount)+"件。 ")]):e._e(),t("div",{staticClass:"top"},[t("div",{staticClass:"top-left",on:{click:function(e){return n.handleChangeItem(i)}}},[t("div",{staticClass:"originpic"},[null!==i&&void 0!==i&&null!==(l=i.currentActivedItem)&&void 0!==l&&null!==(u=l.imgs)&&void 0!==u&&u.whiteBgPng||null!==i&&void 0!==i&&null!==(d=i.currentActivedItem)&&void 0!==d&&null!==(v=d.imgs)&&void 0!==v&&v.cover?[t(n.Thumbnail,{attrs:{url:(null===i||void 0===i||null===(m=i.currentActivedItem)||void 0===m||null===(p=m.imgs)||void 0===p?void 0:p.whiteBgPng)||(null===i||void 0===i||null===(g=i.currentActivedItem)||void 0===g||null===(f=g.imgs)||void 0===f?void 0:f.cover)+"!lfit_w750_jpg",size:{width:"100%",height:"100%"}}})]:t("div",{staticClass:"addicon"},[t("img",{attrs:{src:"https://cdn.qiandaoapp.com/interior/images/ce0b7f15e91184f8ff70cecb4c6d5d14.png!lfit_w750_jpg'",alt:""}})])],2)]),t("div",{staticClass:"resultlist"},[t("div",{staticClass:"content"},[t("div",{staticClass:"content-title"},[e._v(" "+e._s((null===i||void 0===i||null===(h=i.currentActivedItem)||void 0===h?void 0:h.name)||(null===i||void 0===i||null===(C=i.currentActivedItem)||void 0===C?void 0:C.originInputName))+" "),t("div",{staticClass:"content-title-delete",on:{click:function(e){return n.handleConfirmDelete(i.index)}}},[t(n.DuIcon,{attrs:{size:"32rpx",name:"delete"}})],1)]),t("div",{staticClass:"content-spec"},[e._v(" "+e._s(null===i||void 0===i||null===(I=i.currentActivedItem)||void 0===I||null===(b=I.entry_profile)||void 0===b||null===(_=b[0])||void 0===_||null===(A=_.profiles)||void 0===A||null===(w=A[0])||void 0===w?void 0:w.dataValue)+" ")]),t("div",{staticClass:"acts"},[t("div",{staticClass:"acts-left"},[t("div",{staticClass:"price"},[t("span",{staticClass:"price-suffix"},[e._v("¥")]),t("input",{directives:[{name:"model",rawName:"v-model",value:i.currentActivedItem.currentPrice,expression:"item.currentActivedItem.currentPrice"}],attrs:{type:"number",placeholder:"填价格"},domProps:{value:i.currentActivedItem.currentPrice},on:{input:function(t){t.target.composing||e.$set(i.currentActivedItem,"currentPrice",t.target.value)}}})]),t("div",{staticClass:"edit",on:{click:function(e){return n.handleShowRemark(i.currentActivedItem)}}},[t(n.DuIcon,{attrs:{size:"32rpx",name:"add-detail"}})],1)]),t("div",{staticClass:"acts-right"},[t("div",{staticClass:"reduce",on:{click:function(e){return n.handleReduceCount(i.currentActivedItem,i.index)}}},[t(n.DuIcon,{attrs:{size:"32rpx",name:"reduce"}})],1),t("input",{directives:[{name:"model",rawName:"v-model",value:i.currentActivedItem.currentCount,expression:"item.currentActivedItem.currentCount"}],attrs:{type:"number"},domProps:{value:i.currentActivedItem.currentCount},on:{input:[function(t){t.target.composing||e.$set(i.currentActivedItem,"currentCount",t.target.value)},e=>n.handleChangeCount(e,i.currentActivedItem)]}}),t("div",{staticClass:"plus",on:{click:function(e){return n.handleAddCount(i.currentActivedItem)}}},[t(n.DuIcon,{attrs:{size:"32rpx",name:"plus"}})],1)])]),t("div",{staticClass:"info"},[n.getPriceText(i.currentActivedItem)?t("div",{staticClass:"info-price"},[e._v(" "+e._s(n.getPriceText(i.currentActivedItem))+" ")]):e._e(),i.currentActivedItem.isShowRemark?t("div",[t("textarea",{directives:[{name:"model",rawName:"v-model",value:i.currentActivedItem.remark,expression:"item.currentActivedItem.remark"}],attrs:{autofocus:"",placeholder:"请输入描述，如：新旧程度、入手原因、转手原因、不超过10字（选填）",name:"",id:i.currentActivedItem.id,rows:"3",maxlength:"10"},domProps:{value:i.currentActivedItem.remark},on:{blur:function(e){return n.handleBulrTextarea(i.currentActivedItem)},input:function(t){t.target.composing||e.$set(i.currentActivedItem,"remark",t.target.value)}}})]):e._e()])])])])]):e._e()])})),0)},g=[],f=(n("e17f"),n("2241")),h=n("d17e"),C=n("dec5"),I={__name:"CardList",props:{mapData:{type:Array,default:()=>[]},txtResultUrlList:{type:Array,default:()=>[]},specData:{type:Array,default:()=>[]},currentSelectedSpecs:{type:Array,default:()=>[]}},emits:["onClickResultListItem","onRemoveOneCard","onChangeItem"],setup(e,{emit:t}){const n=e,{proxy:i}=Object(c["getCurrentInstance"])(),r=e=>{t("onChangeItem",e.index)},s=Object(c["computed"])(()=>{const e=n.mapData.length;let t=0,i=0;return n.mapData.forEach(e=>{e.list.length?t++:i++}),{allCount:e,successCount:t,failedCount:i}}),o=()=>{},l=e=>{let t="";return e&&(n.isEdit?(null!==e&&void 0!==e&&e.minPrice&&(t=`闲置最低 ${e.minPrice} 元`),e.minPrice&&e.c2cAvgPrice&&(t+="，"),e.c2cAvgPrice&&(t+=`成交均价 ${e.c2cAvgPrice} 元`),(e.minPrice||e.c2cAvgPrice)&&e.stockOrderAvgPrice&&(t+=";"),e.stockOrderAvgPrice&&(t+=`闪购均价 ${e.stockOrderAvgPrice} 元`)):(null!==e&&void 0!==e&&e.minPrice&&(t=`玩家在卖 ${e.minPrice} 元起`),e.minPrice&&e.strikePrice&&(t+="，"),e.strikePrice&&(t+=`成交均价 ${e.strikePrice?Number(e.strikePrice).toFixed(1):e.strikePrice} 元`))),t},u=e=>{f["a"].confirm({message:"确认删除吗",cancelButtonText:"否",confirmButtonText:"是"}).then(()=>{t("onRemoveOneCard",e)})},d=(e,t)=>{console.log("currentItem",t.currentCount);try{(t.currentCount<=0||!t.currentCount)&&a["c"].show({icon:"none",title:"请设置正确商品个数"})}catch(e){console.log(e),a["c"].show({icon:"none",title:"请设置正确商品个数"})}},v=(e,t)=>{e.currentCount>1?e.currentCount--:u(t)},m=e=>{e.currentCount++},p=e=>{e.isShowRemark=!0},g=e=>{e.remark.length||(e.isShowRemark=!1)},I=(e,n)=>{t("onClickResultListItem",{singleData:e,itemIndex:n})};return{__sfc:!0,proxy:i,props:n,emits:t,handleChangeItem:r,countInfo:s,addSpu:o,getPriceText:l,handleConfirmDelete:u,handleChangeCount:d,handleReduceCount:v,handleAddCount:m,handleShowRemark:p,handleBulrTextarea:g,handleClickResultListItem:I,Thumbnail:h["a"],DuIcon:C["a"]}}},b=I,_=(n("74d3"),n("0c7c")),A=Object(_["a"])(b,p,g,!1,null,"753a0cf3",null),w=A.exports,x=n("4360"),P={__name:"index",setup(e){const{proxy:t}=Object(c["getCurrentInstance"])(),n=[{name:"来源",key:"from",list:[{label:"转赠",value:"173435"}]},{name:"状态",key:"status",list:[{label:"全新未拆盒",value:"3"}]}],i={originInputName:void 0,currentPrice:void 0,currentCount:1,isShowRemark:!1,remark:""},r=Object(c["ref"])(["173435","3"]),p=Object(c["ref"])(!1),g=Object(c["ref"])(void 0),f=Object(c["ref"])([]),h=Object(c["ref"])([]),C=Object(c["ref"])(),I=Object(c["ref"])(),b=Object(c["ref"])([]),_=Object(c["ref"])(0),A=Object(c["ref"])(""),P=Object(c["ref"])([]),y=Object(c["computed"])(()=>x["a"].state.user.me),O=Object(c["computed"])(()=>f.value.length-_.value),k=async()=>{if(!h.value.length)return a["b"].hide(),void a["c"].show({icon:"none",title:"未识别到可转赠商品"});for(let e=0;e<h.value.length;e++)d["a"].searchSpuInTag({orTypeIds:"15",q:h.value[e].name,"start-index":0,"max-results":10}).then(t=>{if(200===t.code){var n,r,c,s;console.log(111);const o=t.data.items;console.log("resultList===",o);const a=Object.assign((null===o||void 0===o?void 0:o[0])||{},i),l=t.data.items.map(e=>Object.assign(e,i));a.currentPrice=h.value[e].price,a.originInputName=h.value[e].name;const u={index:e,currentActivedItem:a,list:l.slice(0,1)};null!==(n=u.currentActivedItem)&&void 0!==n&&null!==(r=n.imgs)&&void 0!==r&&r.whiteBgPng||null!==u&&void 0!==u&&null!==(c=u.currentActivedItem)&&void 0!==c&&null!==(s=c.imgs)&&void 0!==s&&s.cover?o.length?b.value.unshift(u):b.value.push(u):console.log("tempObj===",u)}}).finally(()=>{_.value++,a["b"].hide()})},D=e=>{P.value.splice(e,1)},L=({itemIndex:e,singleIndex:t})=>{P.value[e].tagList.splice(t,1)},j=({singleData:e,itemIndex:t})=>{const n=b.value;let i=0;b.value.forEach((e,n)=>{e.index===t&&(i=n)}),n[i].currentActivedItem=e,b.value=n},R=async()=>{const e=b.value.some(e=>!+e.currentActivedItem.currentPrice),n=b.value.some(e=>!+e.list.length);if(e)return void a["c"].show({icon:"none",title:"有未填写价格的商品哦"});if(n)return void a["c"].show({icon:"none",title:"有未识别成功的商品哦，请添加后再发布"});a["b"].show({title:"发布中"});const i=b.value.map(e=>({spuId:e.currentActivedItem.id,stock:e.currentActivedItem.currentCount,price:parseFloat((+e.currentActivedItem.currentPrice).toFixed(2)),remark:e.currentActivedItem.remark,status:"ON_SALE",specValueIds:r.value})),c=await d["a"].createProductMulti({args:i});if(0===c.code){await Object(u["b"])({productIds:c.data.productIds,scene:"multi_plugins"});const e="/modules/pages-plugin/publisher?biz="+C.value;(Object(m["h"])()||Object(m["d"])())&&t.navigateTo({url:e})}else a["c"].show({icon:"none",title:"发布失败"});a["b"].hide()},S=80,T=e=>{const t={CHOUHE:{sceneKeyWord:"抽盒",name:"chouhe",splitFlag:{start:["抽盒"],end:["实付款"]},ignoreList:[],finalIgnoreList:["实付"],cropFlag:"实付",cropDefaultConfig:{topX:-260,topY:40,width:250,height:250}}};for(let n=0;n<Math.min(20,e.length);n++)for(const i in t)if(e[n].word.includes(t[i].sceneKeyWord))return t[i];return null},E=({arr:e,splitFlag:t,ignoreList:n,ignoreEndFlag:i})=>{const r=[];let c=[],s=!1,o=!!i;for(let a=0;a<e.length;a++){const l=e[a];if(i&&l.word===i){o=!1;continue}if(o)continue;if(n.some(e=>new RegExp(e).test(l.word)))continue;const u=0===t.start.length||t.start.some(e=>new RegExp(e).test(l.word));u&&!s&&(s=!0),s&&c.push(l);const d=t.end.some(e=>new RegExp(e).test(l.word));d&&s&&(c.length>=2&&r.push(c),c=[],s=!1)}return c.length>=3&&r.push(c),r},F=(e,t)=>{const n=T(e),i=E({arr:e,splitFlag:n.splitFlag,ignoreList:n.ignoreList,ignoreEndFlag:n.ignoreEndFlag}),r=t,c=i.filter(e=>e.some(e=>e.word.includes("可赠与给好友"))),s=[];return c.forEach((e,t)=>{var i,c,o;e.reduce((e,t)=>Math.max(e,t.word.length),0);const a=e,{cropFlag:l}=n,u=(null===(i=a.filter(e=>e.word.includes(l)))||void 0===i||i[0],a[0]),d=n.cropDefaultConfig.topX,v=n.cropDefaultConfig.topY,m=n.cropDefaultConfig.width,p=n.cropDefaultConfig.height;console.log("cropOriginResultItem.pos[0]==",u);const g=+u.pos[0].posX+d,f=+u.pos[0].posY+v+.8*t*S,h=g>0?g:0,C=f>0?f:0,I=m,b=p,_=`${r}!crop_${h}_${C}_${I}_${b}`;s.push({cropedCover:_,currentPrice:void 0,currentCount:1,desc:null===a||void 0===a||null===(c=a[1])||void 0===c?void 0:c.word,name:null===a||void 0===a||null===(o=a[1])||void 0===o?void 0:o.word,tagList:a[0].tagList,items:a})}),s},$=e=>new Promise(t=>setTimeout(t,e)),B=async()=>{a["b"].show({title:"识别中"});const e=I.value.map((e,t)=>{const n=500*t;return $(n).then(()=>v["a"].ocr({url:e+"!lfit_w1080.jpg",ocrType:"MODELSCOPE",level:"HD"}).then(t=>{const n=t.data.prismWordsInfo,i=F(n,e);return console.log("OCR completed for URL:",e),i}))});Promise.all(e).then(e=>{P.value=e.flat(),h.value=P.value.map(e=>({name:e.name})),k(),console.log("All OCR processes are completed.")}).catch(e=>{a["b"].hide(),console.error("Error during OCR processing:",e)}).finally(()=>{_.value=I.value.length,console.log("Final count updated:",_.value)})},z=()=>{const e="/modules/pages/common-login/index";(Object(m["h"])()||Object(m["d"])())&&t.navigateTo({url:e})};return Object(c["onMounted"])(async()=>{const{biz:e,filesKey:n,userId:i}=t.$route.query;if("{}"===JSON.stringify(y.value)&&i)return console.log("====not login===="),void z();C.value=e;const r=await Object(l["c"])({key:n});I.value=r.data,B()}),{__sfc:!0,proxy:t,specData:n,defaultItemInfo:i,currentSelectedSpecs:r,isShowSearchDialog:p,currentReplaceCardIndex:g,fileList:f,txtResultUrlList:h,localBiz:C,imgsResultUrlList:I,spuMapList:b,spuMapCount:_,remark:A,resultData:P,me:y,remainingJobCount:O,handleSearchSpuList:k,onDeleteItem:D,onDeleteItemTag:L,onClickResultListItem:j,handlePublish:R,DELTA_PX:S,getConfigFromList:T,splitAndFilter:E,generate2dMapArray:F,delay:$,processOcr:B,logIn:z,DuButton:s["a"],SpecList:o["a"],CardList:w}}},y=P,O=(n("40a2"),Object(_["a"])(y,i,r,!1,null,"650666cb",null));t["default"]=O.exports},bbd0:function(e,t,n){}}]);